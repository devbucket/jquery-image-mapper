/* jQuery Image Mapper v0.6.8 - https://github.com/devbucket/jquery-image-mapper
 * Draw image maps the old fashioned way just with HTML, jQuery and jQuery UI.
 * 
 * Copyright (c) 2015 Florian Mueller
 * Licensed under the GPL license
 * 2015-07-10
 */
!function(a){"use strict";a.fn.overlaps=function(b,c,d){var e={targets:[],hits:[]},f=a(b),g="undefined"==typeof c?1:c,h="undefined"==typeof d&&"boolean"!=typeof d?!1:d;return this.each(function(){var c=a(this),d=c.offset();d.right=d.left+c.outerWidth(),d.bottom=d.top+c.outerHeight();var i=f.offset();i.right=i.left+f.outerWidth(),i.bottom=i.top+f.outerHeight();var j=i.right+g,k=i.left-g,l=i.bottom+g,m=i.top-g,n=!(j<d.left||k>d.right||l<d.top||m>d.bottom);h&&(n=k<d.left||j>d.right||m<d.top||l>d.bottom),n&&(e.targets.push(this),e.hits.push(b))}),e}}(jQuery),function(a){"use strict";var b="imageMapper";a.widget("ui."+b,a.ui.mouse,{DIRECTION_HORIZONTAL:"horizontal",DIRECTION_VERTICAL:"vertical",options:{scopeObject:a(document),data:[],clickIgnoreClass:"ui-image-mapper-click-ignore",blockDeleteByKey:!1,handleCollision:!0,collisionTolerance:0,autoHideHandles:!0,elementClass:"ui-image-mapper",elementDisabledClass:"ui-image-mapper-disabled",percentageValues:!1,drawHelperClass:"ui-image-mapper-helper",drawHelperSpecialClass:"",drawHelperMinWidth:20,drawHelperMinHeight:20,drawHelperContainerClass:"ui-image-mapper-maps",objectTypes:"div",zIndex:10,zIndexActive:150,revertDuration:100,borderDrawSize:"1px",borderDrawStyle:"dotted",borderDrawColor:"#000",borderDrawErrorSize:"1px",borderDrawErrorStyle:"dotted",borderDrawErrorColor:"#ff0000",borderDrawWarningSize:"1px",borderDrawWarningStyle:"dotted",borderDrawWarningColor:"#ffc000",borderSize:"1px",borderStyle:"solid",borderColor:"#69bce2",borderActiveSize:"1px",borderActiveStyle:"solid",borderActiveColor:"#00aeff",borderActiveErrorSize:"1px",borderActiveErrorStyle:"solid",borderActiveErrorColor:"#ff0000",borderActiveWarningSize:"1px",borderActiveWarningStyle:"solid",borderActiveWarningColor:"#ffc000",backgroundDrawColor:"rgba(0,174,255,0)",backgroundDrawErrorColor:"rgba(255,0,0,0.1)",backgroundColor:"rgba(0,174,255,0.1)",backgroundWarningColor:"rgba(255,192,0,0.1)",backgroundActiveColor:"rgba(0,174,255,0.25)",backgroundActiveErrorColor:"rgba(255,0,0,0.35)",backgroundActiveWarningColor:"rgba(255,192,0,0.35)"},_init:function(){var c=this,d=c.options;c.pluginName=b,c.elementTag="<"+d.objectTypes+"/>",c.mapItems=[],c.dragged=!1,c.active=null,c._mouseInit(),c.element.addClass(d.elementClass).css({display:"inline-block",position:"relative"}),c.element.children("img").css({position:"relative","z-index":1,"pointer-events":"none"}),d.percentageValues&&c.element.children("img").css({width:"100%","max-width":"100%",height:"auto"}),c.container=a(c.elementTag).addClass(d.drawHelperContainerClass).css({position:"absolute","z-index":2,top:0,left:0,width:"100%",height:"100%",overflow:"hidden"}).appendTo(c.element),c.helper=a(c.elementTag).addClass(d.drawHelperClass+" drag"),c._trigger("init",c),a("."+d.clickIgnoreClass).find("*").each(function(){a(this).addClass(d.clickIgnoreClass)}),a(document).on("keyup.imageMapper",function(a){8!==a.keyCode&&46!==a.keyCode||!c.active||d.blockDeleteByKey||(a.preventDefault(),c._deleteActive(a))}),a(document).on("keydown.imageMapper",function(a){c._trigger("deleteMap"),8!==a.keyCode&&46!==a.keyCode||!c.active||d.blockDeleteByKey||a.preventDefault()}),d.scopeObject.on("mouseup.imageMapper",function(b){a(b.target).hasClass(d.drawHelperClass)||c._clickedIgnoredItem(b)||c.dragged||(c._setInactive(a("."+d.drawHelperClass+".active")),c.active=null,d.drawHelperSpecialClass="",c._trigger("inactive",b))}),c._setExistingData()},_clickedIgnoredItem:function(b){return a(b.target).hasClass(this.options.clickIgnoreClass)},_setExistingData:function(){var b,c=this,d=c.options;d.data.length&&a.each(d.data,function(e,f){var g=null,h=a(c.elementTag).appendTo(c.container);""!==d.drawHelperSpecialClass&&(g=d.drawHelperSpecialClass),"undefined"!=typeof f.special&&(g=f.special),h.css({"z-index":d.zIndex+(c.mapItems.length+1),position:"absolute",left:c._parseValue(f.left,c.DIRECTION_HORIZONTAL,!0),top:c._parseValue(f.top,c.DIRECTION_VERTICAL,!0),width:c._parseValue(f.width,c.DIRECTION_HORIZONTAL,!0),height:c._parseValue(f.height,c.DIRECTION_VERTICAL,!0)}).addClass(d.drawHelperClass+" "+g+" drop").attr("data-id",c.mapItems.length+1),null!==g&&h.attr("data-special",g),c._addDraggable(h),c._addResizable(h),h.click(function(b){var e=a(b.target).hasClass(d.drawHelperClass)?a(b.target):a(b.target).parent();e.hasClass("active")||(c._setInactive(a("."+d.drawHelperClass+".active")),c._setActive(e),c._trigger("active",b,c.active))}),b=f,delete b.id,delete b.special,delete b.left,delete b.top,delete b.width,delete b.height,c._setInactive(h),c._saveMapItem(h,f.id,g,b)})},items:function(){return this.mapItems},item:function(){return this.active},toggleSpecial:function(b){var c=parseInt(a(this.active).attr("data-id"),10)-1;a(this.active).removeClass(a(this.active).attr("data-special")).addClass(b).attr("data-special",b),this.options.drawHelperSpecialClass=b,this.mapItems[c].special=b,this._triggerUpdateItems(null)},deleteActive:function(a){this._deleteActive(a)},addMapData:function(b){if("unedfined"!=typeof b&&null!==this.active){var c=parseInt(a(this.active).attr("data-id"),10)-1;a.extend(this.mapItems[c],b),this._triggerUpdateItems(null)}},setWarning:function(a){this._setWarning("#"+a.id)},resetWarning:function(a){this._resetErrorOrWarning("#"+a.id)},destroy:function(){var b=this,c=this.element.children("img");a(document).off(".imageMapper"),b.options.scopeObject.off(".imageMapper"),c.css({position:"","z-index":"","pointer-events":""}),this.options.percentageValues&&this.element.children("img").css({width:"","max-width":"",height:""}),""==c.attr("style")&&c.removeAttr("style"),a(this.element).removeClass(this.options.elementClass).removeClass(this.options.elementDisabledClass).css({position:""}),""==this.element.attr("style")&&this.element.removeAttr("style"),""==this.element.attr("class")&&this.element.removeAttr("class"),a(this.element).each(function(){var c="ui"+b.pluginName.charAt(0).toUpperCase()+b.pluginName.slice(1);a(this).removeData(c)}),a("."+this.options.drawHelperContainerClass).remove(),this.mapItems.splice(0,this.mapItems.length),this.dragged=!1,this.active=null,this._mouseDestroy(),delete this.container,delete this.helper,delete this.active,this._trigger("destroy"),a.Widget.prototype.destroy.apply(this,arguments)},_mouseStart:function(b){var c=this,d=c.options;d.disabled||(c.container.css({"pointer-events":"none"}),c.elPos=a(c.element).offset(),c.opos=[b.pageX-c.elPos.left,b.pageY-c.elPos.top],c._trigger("start",b,c.helper),c._setInactive(a("."+d.drawHelperClass+".active")),a(c.container).append(c.helper),c.helper.css({"z-index":d.zIndex+(c.mapItems.length+1),position:"absolute",left:c._parseValue(c.opos[0],c.DIRECTION_HORIZONTAL),top:c._parseValue(c.opos[1],c.DIRECTION_VERTICAL),width:c._parseValue(0,c.DIRECTION_HORIZONTAL),height:c._parseValue(0,c.DIRECTION_VERTICAL)}),c._setDraw(c.helper))},_mouseDrag:function(a){var b=this;if(b.dragged=!0,b.options.disabled)return!1;var c=b.opos[0]+2,d=b.opos[1]+2,e=a.pageX-b.elPos.left,f=a.pageY-b.elPos.top;if(c>e){var g=e;e=c,c=g}return b.helper.css({left:b._parseValue(c,b.DIRECTION_HORIZONTAL),top:b._parseValue(d,b.DIRECTION_VERTICAL),width:b._parseValue(e-c,b.DIRECTION_HORIZONTAL),height:b._parseValue(f-d,b.DIRECTION_VERTICAL)}),b._trigger("drag",a),b._colliding()?b._setDrawError(b.helper):b._setDraw(b.helper),!1},_mouseStop:function(b){var c,d=this,e=d.options,f=null;return d.dragged=!1,e.disabled?!1:(d._setMinWidth(d.helper),d._colliding()?d._resetAll(d.helper):(c=d.helper.clone().appendTo(d.container),d._setActive(c),c.removeClass("drag").addClass(e.drawHelperSpecialClass+" drop"),""!==e.drawHelperSpecialClass&&(f=e.drawHelperSpecialClass,c.attr("data-special",f)),d._trigger("active",b,c),d._addDraggable(c),d._addResizable(c),c.attr("data-id",this.mapItems.length+1).click(function(b){var c=a(b.target).hasClass(e.drawHelperClass)?a(b.target):a(b.target).parent();c.hasClass("active")||(d._setInactive(a("."+e.drawHelperClass+".active")),d._setActive(c),d._trigger("active",b,d.active))}),d._saveMapItem(c,null,f),d.helper.remove(),d._triggerUpdateItems(b)),d.container.css({"pointer-events":"auto"}),!1)},_addDraggable:function(b){var c=this,d=c.options;a(b).draggable({stack:d.drawHelperClass,containment:"parent",revertDuration:d.revertDuration,revert:function(){return c._colliding()},drag:function(a,b){c._colliding()?c._setError(b.helper):c._setActive(b.helper)},start:function(b,e){a(e.helper).hasClass("active")||c._setInactive(a("."+d.drawHelperClass+".active")),a(e.helper).removeClass("drop").addClass("drag"),c._setActive(e.helper),c._trigger("active",event,c.active)},stop:function(b,d){if(!c._colliding()){var e=parseInt(a(d.helper).attr("data-id"),10)-1;c._resetErrorOrWarning(d.helper),c.mapItems[e].left=c._parseValue(d.position.left,c.DIRECTION_HORIZONTAL),c.mapItems[e].top=c._parseValue(d.position.top,c.DIRECTION_VERTICAL),c._triggerUpdateItems(b)}a(d.helper).removeClass("drag").addClass("drop")}})},_addResizable:function(b){var c=this,d=c.options;a(b).resizable({minWidth:d.drawHelperMinWidth,minHeight:d.drawHelperMinHeight,autoHide:c.options.autoHideHandles,containment:"parent",resize:function(a,b){c._colliding()?c._setError(b.helper):c._setActive(b.helper)},start:function(b,e){a(e.helper).hasClass("active")||c._setInactive(a("."+d.drawHelperClass+".active")),a(e.helper).removeClass("drop").addClass("drag"),c._setActive(e.helper),c._trigger("active",event,c.active)},stop:function(b,d){if(c._colliding())a(d.helper).animate({width:c._parseValue(d.originalSize.width,c.DIRECTION_HORIZONTAL),height:c._parseValue(d.originalSize.height,c.DIRECTION_VERTICAL)},c.options.revertDuration,function(){c._setActive(d.helper)});else{var e=parseInt(a(d.helper).attr("data-id"),10)-1;c.mapItems[e].width=c._parseValue(d.size.width,c.DIRECTION_HORIZONTAL),c.mapItems[e].height=c._parseValue(d.size.height,c.DIRECTION_VERTICAL),c._triggerUpdateItems(b)}a(d.helper).removeClass("drag").addClass("drop")}})},_setMinWidth:function(b){var c=this.options,d=c.drawHelperMinWidth>=10?c.drawHelperMinWidth:10,e=c.drawHelperMinHeight>=10?c.drawHelperMinHeight:10;a(b).width()<d&&a(b).css({width:this._parseValue(d,this.DIRECTION_HORIZONTAL)}),a(b).height()<e&&a(b).css({height:this._parseValue(e,this.DIRECTION_VERTICAL)})},_setActive:function(b){var c=this.options;this.active=a(b),a(b).css({"z-index":c.zIndexActive,border:c.borderActiveSize+" "+c.borderActiveStyle+" "+c.borderActiveColor,"background-color":c.backgroundActiveColor}).addClass("active"),a(b).hasClass("warning")&&this._setWarning(b)},_setInactive:function(b){var c=this.options;a(b).css({"z-index":c.zIndex,border:c.borderSize+" "+c.borderStyle+" "+c.borderColor,"background-color":c.backgroundColor}).removeClass("active"),a(b).hasClass("warning")&&this._setWarning(b)},_setWarning:function(b){var c=this.options;a(b).hasClass("active")?a(b).css({border:c.borderActiveWarningSize+" "+c.borderActiveWarningStyle+" "+c.borderActiveWarningColor,"background-color":c.backgroundActiveWarningColor}).addClass("warning"):a(b).css({border:c.borderDrawWarningSize+" "+c.borderDrawWarningStyle+" "+c.borderDrawWarningColor,"background-color":c.backgroundWarningColor}).addClass("warning")},_setError:function(b){var c=this.options;a(b).css({border:c.borderActiveErrorSize+" "+c.borderActiveErrorStyle+" "+c.borderActiveErrorColor,"background-color":c.backgroundActiveErrorColor}).addClass("error")},_resetErrorOrWarning:function(b){var c=this.options;a(b).hasClass("active")?a(b).css({"z-index":c.zIndexActive,border:c.borderActiveSize+" "+c.borderActiveStyle+" "+c.borderActiveColor,"background-color":c.backgroundActiveColor}).removeClass("error warning"):a(b).css({border:c.borderSize+" "+c.borderStyle+" "+c.borderColor,"background-color":c.backgroundColor}).removeClass("error warning")},_setDraw:function(b){var c=this.options;a(b).css({"z-index":c.zIndex,border:c.borderDrawSize+" "+c.borderDrawStyle+" "+c.borderDrawColor,"background-color":c.backgroundDrawColor})},_setDrawError:function(b){var c=this.options;a(b).css({border:c.borderDrawErrorSize+" "+c.borderDrawErrorStyle+" "+c.borderDrawErrorColor,"background-color":c.backgroundDrawErrorColor})},_resetAll:function(b){a(b).animate({"z-index":this.options.zIndex,width:this._parseValue(0,this.DIRECTION_HORIZONTAL),height:this._parseValue(0,this.DIRECTION_VERTICAL),"border-color":"rgba(0,0,0,0)"},this.options.revertDuration,function(){a(b).remove()})},_deleteActive:function(a){null!==this.active&&(this._deleteMapItem(this.active),this.active.remove(),this.active=null,this._triggerUpdateItems(a),this._trigger("inactive",a))},_saveMapItem:function(b,c,d,e){var f=this.options,g={};("undefined"==typeof c||null===c)&&(c=f.drawHelperClass+"-"+(this.mapItems.length+1)),a(b).attr("id",c),g.id=c,g.left=this._parseValue(b.css("left"),this.DIRECTION_HORIZONTAL),g.top=this._parseValue(b.css("top"),this.DIRECTION_VERTICAL),g.width=this._parseValue(b.css("width"),this.DIRECTION_HORIZONTAL),g.height=this._parseValue(b.css("height"),this.DIRECTION_VERTICAL),""!==f.drawHelperSpecialClass&&(g.special=f.drawHelperSpecialClass),"undefined"!=typeof d&&(g.special=d),"undefined"!=typeof e&&0!==e.length&&a.extend(g,e),this.mapItems.push(g)},_deleteMapItem:function(b){var c=parseInt(a(b).attr("data-id"),10)-1;this.mapItems.splice(c,1)},_parseValue:function(a,b,c){var d;if("undefined"==typeof b&&(b=this.DIRECTION_HORIZONTAL),"undefined"==typeof c&&(c=!1),this.options.percentageValues!==!0||c)d=c?a:a.toString().replace("px","")+"px";else switch(b){case this.DIRECTION_HORIZONTAL:default:d=this._pixelToPercentageHorizontal(a);break;case this.DIRECTION_VERTICAL:d=this._pixelToPercentageVertical(a)}return d},_pixelToPercentageHorizontal:function(a){var b=parseFloat(a.toString().replace("px","")),c=parseFloat(this.element.children("img").width().toString()),d=100/c*b;return d+"%"},_pixelToPercentageVertical:function(a){var b=parseFloat(a.toString().replace("px","")),c=parseFloat(this.element.children("img").height().toString()),d=100/c*b;return d+"%"},_colliding:function(){if(this.options.handleCollision===!0){var b=a(".drag"),c=a(".drop"),d=a(this.container),e=c.overlaps(b,this.options.collisionTolerance),f=d.overlaps(b,this.options.collisionTolerance,!0);return e.targets.length>0||f.targets.length>0}return!1},_triggerUpdateItems:function(a){var b=this.mapItems.length?this.mapItems:null;this._trigger("updated",a,[b])}}),a.extend(a.ui.imageMapper,{defaults:a.extend({},a.ui.mouse.defaults)})}(jQuery);